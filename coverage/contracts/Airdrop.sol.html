<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Airdrop.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Airdrop.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>20/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>24/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>4/4</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>28/28</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity 0.8.22;
&nbsp;
import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";
&nbsp;
/**
 * @title Airdrop Contract
 * @dev This contract handles the distribution of tokens through an airdrop with a vesting period.
 * Beneficiaries can claim their tokens over time, based on a linear vesting schedule.
 * The owner can set the recipients and their claimable amounts before the claim period starts.
 */
contract Airdrop is Ownable {
    /// @notice The ERC20 token being distributed in the airdrop
    IERC20 public token;
&nbsp;
    /// @notice Mapping to store the claimable tokens for each recipient
    mapping(address =&gt; uint256) public claimableTokens;
&nbsp;
    /// @notice Mapping to track how many tokens each recipient has already claimed
    mapping(address =&gt; uint256) public claimedTokens;
&nbsp;
    /// @notice Total number of tokens allocated for the airdrop
    uint256 public totalClaimable;
&nbsp;
    /// @notice Timestamp when the claim period starts
    uint256 public claimPeriodStart;
&nbsp;
    /// @notice Timestamp when the claim period ends
    uint256 public claimPeriodEnd;
&nbsp;
    /// @dev Vesting period duration (in seconds), set to 180 days (6 months)
    uint256 public constant VESTING_PERIOD = 180 days;
&nbsp;
    /// @notice Event emitted when a recipient claims tokens
    /// @param recipient The address of the recipient claiming tokens
    /// @param amount The number of tokens claimed
    event HasClaimed(address indexed recipient, uint256 amount);
&nbsp;
    // Custom Errors for gas-efficient error handling
    error ZeroTokenAddress(); // Thrown when the token address is zero
    error ZeroOwnerAddress(); // Thrown when the owner address is zero
    error ClaimStartInThePast(); // Thrown when claim start time is set in the past
    error ClaimEndBeforeStart(); // Thrown when claim end time is set before the claim start time
    error InvalidArrayLength(); // Thrown when the length of recipients and claimableAmount arrays do not match
    error RecipientAlreadySet(); // Thrown when trying to set claimable tokens for a recipient more than once
    error ClaimNotStarted(); // Thrown when attempting to claim tokens before the claim period starts
    error ClaimEnded(); // Thrown when attempting to claim tokens after the claim period has ended
    error NothingToClaim(); // Thrown when there are no tokens available to claim
    error NothingVestedToClaim(); // Thrown when there are no vested tokens to claim
&nbsp;
    /**
     * @dev Constructor to initialize the airdrop contract
     * @param token_ The ERC20 token being distributed
     * @param owner_ The owner of the contract (who can set recipients and withdraw tokens)
     * @param claimPeriodStart_ The timestamp when the claim period starts
     * @param claimPeriodEnd_ The timestamp when the claim period ends
     */
    constructor(
        IERC20 token_,
        address owner_,
        uint256 claimPeriodStart_,
        uint256 claimPeriodEnd_
    ) Ownable() {
        if (address(token_) == address(0)) revert ZeroTokenAddress(); // Ensure the token address is valid
        if (owner_ == address(0)) revert ZeroOwnerAddress(); // Ensure a valid owner address
        if (claimPeriodStart_ &lt;= block.timestamp) revert ClaimStartInThePast(); // Ensure the claim period doesn't start in the past
        if (claimPeriodEnd_ &lt;= claimPeriodStart_) revert ClaimEndBeforeStart(); // Ensure claim period ends after it starts
&nbsp;
        token = token_; // Set the token to be distributed
        claimPeriodStart = claimPeriodStart_; // Set the start time of the claim period
        claimPeriodEnd = claimPeriodEnd_; // Set the end time of the claim period
        _transferOwnership(owner_); // Transfer ownership to the specified owner
    }
&nbsp;
    /**
     * @dev Sets the recipients and their respective claimable token amounts
     * Can only be called by the owner
     * @param recipients_ The array of recipient addresses
     * @param claimableAmount_ The array of token amounts claimable by each recipient
     */
    function setRecipients(
        address[] calldata recipients_,
        uint256[] calldata claimableAmount_
    ) external onlyOwner {
        if (recipients_.length != claimableAmount_.length) revert InvalidArrayLength(); // Ensure both arrays have the same length
&nbsp;
        uint256 sum = totalClaimable; // Track total claimable tokens
        for (uint256 i = 0; i &lt; recipients_.length; i++) {
            if (claimableTokens[recipients_[i]] != 0) revert RecipientAlreadySet(); // Ensure recipient is not already set
&nbsp;
            claimableTokens[recipients_[i]] = claimableAmount_[i]; // Set the claimable amount for each recipient
            unchecked {
                sum += claimableAmount_[i]; // Accumulate total claimable tokens
            }
        }
&nbsp;
        totalClaimable = sum; // Update total claimable tokens
    }
&nbsp;
    /**
     * @dev Allows recipients to claim their vested tokens based on the time that has passed since the claim period started.
     */
    function claim() public {
        if (block.timestamp &lt; claimPeriodStart) revert ClaimNotStarted(); // Ensure the claim period has started
        if (block.timestamp &gt;= claimPeriodEnd) revert ClaimEnded(); // Ensure the claim period has not ended
&nbsp;
        uint256 totalClaimableAmount = claimableTokens[msg.sender]; // Get the total claimable amount for the caller
        if (totalClaimableAmount == 0) revert NothingToClaim(); // Ensure the caller has tokens to claim
&nbsp;
        // Calculate the amount of time that has passed since the claim period started
        uint256 timePassed = block.timestamp - claimPeriodStart;
&nbsp;
        // Calculate the vested amount based on the elapsed time
        uint256 vestedAmount = (totalClaimableAmount * timePassed) / VESTING_PERIOD;
&nbsp;
        // Calculate how many tokens are claimable now (vested amount minus already claimed tokens)
        uint256 claimableNow = vestedAmount - claimedTokens[msg.sender];
        if (claimableNow == 0) revert NothingVestedToClaim(); // Ensure there are vested tokens available to claim
&nbsp;
        // Update claimedTokens mapping to track how many tokens have been claimed
        claimedTokens[msg.sender] += claimableNow;
&nbsp;
        // Transfer the claimable tokens to the caller
        token.transfer(msg.sender, claimableNow);
&nbsp;
        // Emit the claim event
        emit HasClaimed(msg.sender, claimableNow);
    }
&nbsp;
    /**
     * @dev Allows the owner to withdraw any ERC20 tokens from the contract, except the airdrop tokens if needed.
     * @param token_ The ERC20 token address to withdraw (can be any token except the airdrop token).
     * @param amount_ The amount of tokens to withdraw.
     */
    function withdraw(IERC20 token_, uint256 amount_) external onlyOwner {
        IERC20(token_).transfer(msg.sender, amount_); // Transfer the specified token to the owner
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Nov 21 2024 13:28:36 GMT+0100 (Central European Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
